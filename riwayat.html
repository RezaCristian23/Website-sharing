<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Riwayat Input Komponen</title>
  <link rel="icon" type="image/png" href="https://i.postimg.cc/FHxx6SW-V/Logo-Meka-Kalku-JGRP.png">
  <style>
  body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      animation: gradientBG 12s ease infinite;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: rgb(2, 2, 2);
        background: linear-gradient(135deg, #dfe9f3, #ffffff);
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    h1 {
      color: #333;
      margin-bottom: 30px;
      text-align: center;
    }

    .card {
      background: rgba(255, 255, 255, 0.15);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 1000px;
    }

    .table-container {
      overflow-x: auto;
      margin-bottom: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px;
      border-radius: 20px;
    }

      .hapusCheckbox {
      appearance: none;
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(47, 79, 114, 0.85);
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease-in-out;
    }

    .hapusCheckbox:checked {
      background-color: #d9534f;
      border-color: #d9534f;
    }

    .hapusCheckbox:checked::after {
      content: "‚úî";
      color: white;
      font-size: 12px;
      position: absolute;
      top: 0px;
      left: 2px;
    }

    .hapusCheckbox:hover {
      box-shadow: 0 0 5px rgba(217, 83, 79, 0.5);
      transform: scale(1.1);
    }

    .table-container tbody {
      display: block;
      max-height: 500px; 
      overflow-y: auto;
    }

    .table-container thead,
    .table-container tbody tr {
      display: table;
      width: 100%;
      table-layout: fixed;
    }

    th, td {
      padding: 14px 12px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }


thead tr {
  background: linear-gradient(135deg, rgba(8, 102, 202, 0.85), rgba(6, 71, 150, 0.85));
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

th {
  color: #fff;
  background: transparent;
}

  th:first-child {
    border-top-left-radius: 8px;
    border-bottom-left-radius: 1px;
  }

  th:last-child {
    border-top-right-radius: 8px;
    border-bottom-right-radius: 1px;
  }
      

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .NomerID {
      font-weight: bold;
      color: #007bff;
      background: linear-gradient(135deg, rgba(234, 244, 255, 0.8), rgba(212, 234, 255, 0.8));
    }

    .HargaAsli {
      font-weight: bold;
      color: #007bff;
      background: linear-gradient(135deg, #df4d215e, rgba(212, 234, 255, 0.8));
    }
      
    .HargaJual {
      font-weight: bold;
      color: #007bff;
      background: linear-gradient(135deg, rgba(0, 128, 0, 0.267), rgba(212, 234, 255, 0.8));
    }
    
    .TombolAction {
      font-weight: bold;
      color: #007bff;
       background: linear-gradient(135deg, rgba(234, 244, 255, 0.8), rgba(212, 234, 255, 0.8));
      /* background: linear-gradient(135deg,rgba(113, 170, 223, 0.8), rgba(59, 92, 59, 0.267)); */
    }

    .totals {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .total-box {
      background: linear-gradient(135deg, #eaf4ff, #d4eaff, #f7fbff);
      padding: 16px;
      border-radius: 10px;
      text-align: center;
    }
    
    .total-box {
      background: linear-gradient(135deg, rgba(234, 244, 255, 0.8), rgba(212, 234, 255, 0.8));
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 16px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.4);
    }

    .total-box span {
      display: block;
      font-size: 16px;
      font-weight: bold;
      color: #424242b2;
      
    }

    .total-box strong {
      font-size: 20px;
      color: #007bff9d;
    }

    .button-group {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
    }

    button {
      background: linear-gradient(135deg, rgba(8, 102, 202, 0.85), rgba(6, 71, 150, 0.85));
      backdrop-filter: blur(10px);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 15px;
    }

    button:hover {
      background-color: #0056b3;
    }
    
      /* Overlay */
      .popup-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease forwards;
      }

      /* Konten Popup */
      .popup-content {
       background: rgba(255, 255, 255, 0.966);
        padding: 20px 25px;
        border-radius: 10px;
        width: 320px;
        max-width: 90%;
        text-align: center;
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        transform: scale(0.8);
        opacity: 0;
        animation: popUp 0.3s ease forwards;
      }

      .popup-content h3 {
        margin-bottom: 10px;
        color: #333;
      }

      .popup-content p {
        margin-bottom: 20px;
        color: #555;
        font-size: 14px;
      }

      .popup-buttons {
        display: flex;
        justify-content: space-around;
      }

      .popup-buttons button {
        padding: 8px 14px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .btn-ya {
        background: linear-gradient(135deg, rgba(8, 102, 202, 0.85), rgba(6, 71, 150, 0.85));
        color: #fff;
        transition: background 0.3s ease;
      }

      .btn-ya:hover {
         background: linear-gradient(135deg, rgba(7, 34, 63, 0.85), rgba(6, 71, 150, 0.85));
      }

      .btn-batal {
        background: #ccc;
      }

      .btn-batal:hover {
        background: #aaa;
      }

      /* Animasi muncul */
      @keyframes fadeIn {
        from { background: rgba(0,0,0,0); }
        to { background: rgba(0,0,0,0.5); }
      }

      @keyframes popUp {
        0% { transform: scale(0.8); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
      }

    @media (max-width: 600px) {
      body {
        padding: 20px 10px;
      }

      table {
        font-size: 14px;
      }

      th, td {
        padding: 10px 8px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Riwayat Input Komponen</h1>
    <div class="table-container" id="riwayatContainer"></div>
    <div class="button-group">
      <button id="hapusBtn" class="delete-btn" onclick="showPopup()">Hapus yang dipilih</button>
      <button onclick="hapusSemua()">Hapus Semua Riwayat</button>
      <button onclick="cetakPDF()">Cetak Hasil</button>

    </div>
    <ul style="display: flex; gap: 16px; list-style: none; padding: 0; margin: 20px 0 0 0; justify-content: center;">
      <li><a href="index.html" style="text-decoration: none; color: #007BFF;">Kalkulator Komponen</a></li>
      <li><a href="aboutme.html" style="text-decoration: none; color: #007BFF;">About Me</a></li>
    </ul>
    <footer>
      <p style="font-size: 12px; color: #aaa; text-align: center; margin-top: 20px;">&copy; 2025 MekaKalku. All rights reserved.</p>
      <p style="font-size: 12px; color: #aaa; text-align: center; ">Made with ‚ù§Ô∏è by <a href="https://www.instagram.com/rezacristiansilalahi?igsh=MXJ3ZnFtYmk4MmJqbA==" target="_blank" style="color: #00d4ff;">Ckyandaa2</a></p>
    </footer>
  </div>


  <!-- Popup Konfirmasi -->
  <div id="popupConfirm" class="popup-overlay">
    <div class="popup-content">
      <h3>Confirmation alert üì¢</h3>
      <p>Apakah kamu ingin menghapus data yang di pilih?</p>
      <div class="popup-buttons">
        <button class="btn-ya" onclick="hapusTerpilih()">Ya</button>
        <button class="btn-batal" onclick="closePopup()">Batal</button>
      </div>
    </div>
  </div>


  <script>
    let dataRiwayat = JSON.parse(localStorage.getItem('riwayatComponent')) || [];
    const container = document.getElementById('riwayatContainer');

    function renderTable() {
      if (dataRiwayat.length === 0) {
        container.innerHTML = '<p style="text-align:center">Tidak ada riwayat yang tersimpan.</p>';
        return;
      }

      let totalKomponen = 0;
      let totalHargaAsli = 0;
      let totalKeuntungan = 0;
      let totalHargaJual = 0;

      let tableHTML = `
        <div class="table-container">
        <table>
          <thead>
            <tr>   
              <th>No</th>
              <th>Component Used</th>
              <th>Harga Asli</th>
              <th>Keuntungan</th>
              <th>Harga Jual</th>
              <th>Waktu Input</th>
              <th>Pilih</th>
            </tr>
          </thead>
          <tbody>
      `;

      dataRiwayat.forEach((item, index) => {
        tableHTML += `
          <tr>
            <td class="NomerID">${index + 1}</td>
            <td>${item.totalComponent}</td>
            <td class="HargaAsli" style="color: #df4d21c4;">$${item.hargaAsli.toFixed(2)}</td>
            <td style="color: green;" >üí∏${item.keuntungan.toFixed(2)}</td>
            <td style="color: green;" class="HargaJual" style="color: black;" >$${item.hargaJual.toFixed(2)}</td>
            <td>${item.waktuInput || '-'}</td>
            <td class="TombolAction"><input type="checkbox" class="hapusCheckbox" data-index="${index}"></td>
          </tr>
        `;

        totalKomponen += item.totalComponent;
        totalHargaAsli += item.hargaAsli;
        totalKeuntungan += item.keuntungan;
        totalHargaJual += item.hargaJual;
      });

      tableHTML += '</tbody></table></div>';

      const totalHTML = `
        <div class="totals">
          <div class="total-box">
            <span>Total Komponen</span>
            <strong>${totalKomponen}</strong>
          </div>
          <div class="total-box">
            <span>Total Harga Asli</span>
            <strong>$${totalHargaAsli.toFixed(2)}</strong>
          </div>
          <div class="total-box">
            <span>Total Keuntungan</span>
            <strong style="color: green;" >$${totalKeuntungan.toFixed(2)}</strong>
          </div>
          <div class="total-box">
            <span>Total Harga Jual</span>
            <strong>$${totalHargaJual.toFixed(2)}</strong>
          </div>
        </div>
      `;

      container.innerHTML = tableHTML + totalHTML;
    }

    function showPopup() {
      document.getElementById('popupConfirm').style.display = 'flex';
    }

    function closePopup() {
      document.getElementById('popupConfirm').style.display = 'none';
    }

    function hapusTerpilih() {
      const checkboxTerpilih = document.querySelectorAll('.hapusCheckbox:checked');
      if (checkboxTerpilih.length === 0) {
        alert('Pilih data yang ingin dihapus.');
        closePopup();
        return;
      }

      const indexTerpilih = Array.from(checkboxTerpilih)
        .map(cb => parseInt(cb.getAttribute('data-index')));

      dataRiwayat = dataRiwayat.filter((_, index) => !indexTerpilih.includes(index));
      localStorage.setItem('riwayatComponent', JSON.stringify(dataRiwayat));
      renderTable();
      closePopup();
    }


    function hapusSemua() {
      if (confirm("Yakin ingin menghapus semua riwayat?")) {
        localStorage.removeItem('riwayatComponent');
        dataRiwayat = [];
        renderTable();
      }
    }

  async function cetakPDF() {
  Swal.fire({
    title: 'Konfirmasi Cetak PDF',
    text: 'Apakah kamu ingin melakukan cetak PDF?',
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#0866CAD9',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Ya, Cetak',
    cancelButtonText: 'Batal'
  }).then((result) => {
    if (result.isConfirmed) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(18);
      doc.text("Riwayat Input Komponen || MekaKalku", 14, 15);
      doc.setFontSize(12);
      doc.text(`Tanggal Cetak: ${new Date().toLocaleString()}`, 14, 23);

      // Ambil data tabel
      const tableColumn = ["No", "Component", "Harga Asli", "Keuntungan", "Harga Jual", "Waktu Input"];
      const tableRows = [];

      let totalKomponen = 0;
      let totalHargaAsli = 0;
      let totalKeuntungan = 0;
      let totalHargaJual = 0;

      dataRiwayat.forEach((item, index) => {
        const rowData = [
          index + 1,
          item.totalComponent,
          `$${item.hargaAsli.toFixed(2)}`,
          `$${item.keuntungan.toFixed(2)}`,
          `$${item.hargaJual.toFixed(2)}`,
          item.waktuInput || '-'
        ];
        tableRows.push(rowData);

        totalKomponen += item.totalComponent;
        totalHargaAsli += item.hargaAsli;
        totalKeuntungan += item.keuntungan;
        totalHargaJual += item.hargaJual;
      });

      // Tampilkan tabel ke PDF
      doc.autoTable({
        head: [tableColumn],
        body: tableRows,
        startY: 28,
        styles: { fontSize: 10 }
      });

      // Tambah total di bawah tabel
      let finalY = doc.lastAutoTable.finalY + 10;
      doc.setFontSize(12);
      doc.text("Ringkasan Total:", 14, finalY);
      finalY += 6;
      doc.text(`Total Komponen: ${totalKomponen}`, 14, finalY);
      doc.text(`Total Harga Asli: $${totalHargaAsli.toFixed(2)}`, 80, finalY);
      finalY += 6;
      doc.text(`Total Keuntungan: $${totalKeuntungan.toFixed(2)}`, 14, finalY);
      doc.text(`Total Harga Jual: $${totalHargaJual.toFixed(2)}`, 80, finalY);

      // Footer
      finalY += 15;
      doc.setFontSize(10);
      doc.setTextColor(150);
      doc.text("¬© 2025 MekaKalku. All rights reserved.", 14, finalY);
      finalY += 5;
      doc.text("Made with ‚ù§Ô∏è by Ckyandaa2", 14, finalY);

      // Simpan PDF
      doc.save("MekaKalku Riwayat_Penjualan.pdf");

      // Notifikasi sukses
      Swal.fire(
        'Berhasil!',
        'PDF berhasil dibuat dan diunduh.',
        'success'
      );
    }
  });
}

    renderTable();
  </script>
  
  <!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

</body>
</html>
